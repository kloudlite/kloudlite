name: 'push notification to discord'

inputs:
  webhook_url:
    description: 'discord webhook url'
    required: true
  release:
    description: 'release name'
    required: true

runs:
  using: 'composite'
  steps:
    - name: Read Changelog from changelog/${{ inputs.release }}.md
      run: |+
        contents=$(cat changelog/${{ inputs.release }}.md)
        echo "::set-output name=changelog::$contents"
      id: changelog


    - name: Test Success
      uses: rjstone/discord-webhook-notify@v1
      if: success()
      with:
          severity: info
          username: Release Bot
          color: '#aaff00'
          description: Changelog
          details: ${{ steps.changelog.outputs.changelog }}
          footer: Released ${{ inputs.release }}
          text: 'Release Bot'

          webhookUrl: ${{ inputs.webhook_url }}

    # - name: Test Failure
    #   uses: rjstone/discord-webhook-notify@v1
    #   if: failure()
    #   with:
    #       severity: error
    #       details: Test Failed!
    #       webhookUrl: ${{ inputs.webhook_url }}
    #
    # - name: Test Cancelled
    #   uses: rjstone/discord-webhook-notify@v1
    #   if: cancelled()
    #   with:
    #       severity: warn
    #       details: Test Cancelled!
    #       webhookUrl: ${{ inputs.webhook_url }}
