---
global:
  accountName: kloudlite-dev
  name: sample 
  namespace: s1
  providerSecretName: provider-sample
---
label: Create Cloud Provider
query: |+
  mutation Infra_createCloudProvider($cloudProvider: CloudProviderIn!, $providerSecret: SecretIn!) {
    infra_createCloudProvider(cloudProvider: $cloudProvider, providerSecret: $providerSecret) {
      metadata {
        name
        labels
      }
      status {
        isReady
      }
    }
  }
variables:
  providerSecret:
    metadata: &psecret
      name: "{{.providerSecretName}}"
      namespace: "{{.namespace}}"
    stringData:
      accessKey: "key1"
      accessSecret: secret1
  cloudProvider:
    metadata:
      name: '{{.name}}'
    spec:
      display_name: "{{.name}}"
      provider: 'aws' 
      accountName: "{{.accountName}}"
      providerSecret: *psecret
---

label: List Providers
query: |+
  query Query() {
    infra_listCloudProviders {
      metadata {
        name
      }
      spec {
        accountName
        provider
      }
    }
  }
---

label: Get Provider
query: |+
  query Query($name: String!) {
    infra_getCloudProvider(name: $name) {
      syncStatus {
        state
        syncScheduledAt
      }
      metadata{
        name
      }
      spec {
        accountName
      }
    }
  }
variables:
  name: "{{.name}}"

---

label: Delete Provider
query: |+
  mutation Query($name: String!) {
    infra_deleteCloudProvider(name: $name)
  }
variables:
  name: "{{.name}}"
---
