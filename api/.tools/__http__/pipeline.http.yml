# ---
# global:
#   hello: world
---
label: create github pipeline
query: |
  mutation Ci_createPipeline($in: GitPipelineIn!) {
    ci_createPipeline(in: $in)
  }
variables:
  in: 
    name: sample-pipeline
    projectId: proj-s1ok37ubokp62aszwu0jdoq4uorr
    appId: app-pg5r5t4bqez31rvwyjgys8z0k55y
    gitProvider: github
    gitRepoUrl: https://github.com/nxtcoder17/sample
    repoName: sample
    gitBranch: master
    build:
      baseImage: docker
      cmd: |+
        docker build -t ${DOCKER_IMAGE_NAME}:${DOCKER_IMAGE_TAG} .
    run:
      baseImage: docker
      cmd: ""
    artifactRef:
      dockerImageName: harbor.dev.madhouselabs.io/public/sample
      dockerImageTag: latest

---
label: list pipelines
query: |
  query Ci_getPipelines($projectId: ID!) {
    ci_getPipelines(projectId: $projectId) {
      id
      repoName
      name
      gitProvider
      gitRepoUrl
      gitBranch
      build {
        baseImage
        cmd
      }
      run {
        baseImage
        cmd
      }
      metadata
    }
  }
variables:
  projectId: random2
---

label: get pipeline
query: |
  query Ci_getPipelines($pipelineId: ID!) {
    ci_getPipeline(pipelineId: $pipelineId) {
      id
      repoName
      name
      gitProvider
      gitRepoUrl
      build {
        baseImage
        cmd
      }
      gitBranch
      run {
        baseImage
        cmd
      }
      metadata
    }
  }
variables:
  pipelineId: pip-xlf2psoeq4ft215kuyhija7vlezj
---

label: Create Gitlab Pipeline
query: |
  mutation Ci_createPipeline($in: GitPipelineIn!) {
    ci_createPipeline(in: $in)
  }
variables:
  in: 
    name: sample-pipeline

    gitProvider: gitlab
    gitRepoUrl: https://gitlab.com/madhouselabs/sample
    gitBranch: master

    build:
      baseImage: docker
      cmd: |+
        docker build -t ${DOCKER_IMAGE_NAME}:${DOCKER_IMAGE_TAG} .
    run:
      baseImage: docker
      cmd: ""

    artifactRef:
      dockerImageName: harbor.dev.madhouselabs.io/public/gitlab/sample
      dockerImageTag: latest

---
label: Delete pipeline
query: |
  mutation Ci_deletePipeline($pipelineId: ID!) {
    ci_deletePipeline(pipelineId: $pipelineId)
  }
variables:
  pipelineId: pip-h4jeejoxoecix-zmy-arzg3xlx
