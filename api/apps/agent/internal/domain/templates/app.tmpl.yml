apiVersion: crds.kloudlite.io/v1 
kind: App
metadata:
  name: {{.Name}}
  namespace: {{.Namespace}}
spec:
  services:
{{- range .Services }}
    - port: {{.Port }}
      targetPort: {{.TargetPort}}
      type: {{.Type}}
{{- end }}
  containers:
{{- range .Containers }}
  - name: {{.Name}}
    image: {{.Image}}
    imagePullPolicy: {{.ImagePullPolicy}}
    {{- if .Command }}
    command:
      {{- range .Command }}
      - {{.}}
      {{- end }}
    {{- end }}
    {{- if .Args}}
    args:
      {{- range .Args}}
      - {{.}}
      {{- end}}
    {{- end}}
    resourceCpu:
    {{- with .ResourceCpu }}
      min: {{.Min | squote }}
      max: {{.Max | squote}}
    {{- end}}

    resourceMemory:
    {{- with .ResourceMemory }}
      min: {{.Min | squote }}
      max: {{.Max | squote}}
    {{- end}}

    {{- if .Env }}
    env:
      {{- range .Env }}
      - key: {{.Key}}
        value: {{.Value}}
        type: {{.Type}}
        refName: {{.RefName}}
        refKey: {{.RefKey}}
      {{- end}}
    {{- end}}

    {{- if .Volumes }}
    volumes:
      {{- range .Volumes }}
      - name: {{.Name}}
        mountPath: {{.MountPath}}
        type: {{.Type}}
        refName: {{.RefName}}
        items:
        {{- range .Items}}
          - key: {{.Key}}
            fileName: {{.Value}}
        {{- end}}
      {{- end}}
    {{- end}}
{{- end}}

