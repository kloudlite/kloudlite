version: 3

vars:
  ImagePrefix: "ghcr.io/kloudlite/platform"

tasks:
  local-build:
    preconditions:
      - sh: '[[ -n "{{.Tag}}" ]]'
        msg: 'var Tag must have a value'
    vars:
      Name: aws-spot-k3s-termination-handler
      Image: "{{.ImagePrefix}}/{{.Name}}:{{.Tag}}"
    cmds:
      - podman build -t {{.Image}} .
      - podman push {{.Image}}

