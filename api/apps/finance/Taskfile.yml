version: 3

tasks:
  run:
    env:
      DB_NAME: hotspot-finance
      DB_URL: mongodb://mongodb-dev.hotspot.svc.cluster.local:27017
      COOKIE_DOMAIN: localhost
      REDIS_HOSTS: redis-headless.hotspot.svc.cluster.local:6379
      HTTP_PORT: 4002
      # ORIGINS: http://localhost:4002,https://studio.apollographql.com
      # ORIGINS: http://localhost:4002,https://studio.apollographql.com
      IAM_SERVER_HOST: iam.hotspot.svc.cluster.local
      IAM_SERVER_PORT: 80
      # REDIS_USERNAME:
      # REDIS_PASSWORD:
    cmds:
      - nodemon -w "**/*" -e "go" --signal SIGKILL -q --exec 'echo && go run main.go || echo'
  gql:
    sources:
      - graph/schema.graphqls
      - gqlgen.yml
    dir: internal/app
    cmds:
      - go run github.com/99designs/gqlgen generate
