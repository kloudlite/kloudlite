version: 3

dotenv:
- "./.secrets/env"

vars:
  ImagePrefix: ghcr.io/kloudlite/platform/apis

tasks:
  dev:
    interactive: true
    cmds:
      - npm start
  docker-build:
    vars:
      Image: "{{.ImagePrefix}}/gateway:{{.Tag}}"
    preconditions:
      - sh: test -n '{{.Tag}}'
        msg: 'var Tag must be defined'
    cmds:
      - docker build . -t  {{.Image}}
      - docker push {{.Image}}

