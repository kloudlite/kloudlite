version: 3

dotenv:
- "./.secrets/env"

tasks:
  dev:
    interactive: true
    cmds:
      - npm start
  docker-build:
    vars:
      Image: registry.kloudlite.io/kloudlite/{{.EnvName}}/gateway:{{.Tag}}
    preconditions:
      - sh: test -n '{{.EnvName}}'
        msg: 'var EnvName must be defined'
      - sh: test -n '{{.Tag}}'
        msg: 'var Tag must be defined'
    cmds:
      - docker build . -t  {{.Image}}
      - docker push {{.Image}}

