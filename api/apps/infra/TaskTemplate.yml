version: '3'
tasks:
  dev:
    run: always
    deps:
      - pre
      - killPort
    cmds:
      - go run ./main.go
    sources:
      - ./**/*.go

  pre:
    run: once
    cmds:
      - make manifests
      - make generate
      - sleep 0.5

  killPort:
    run: always
    cmds:
      - |
        PID=$(lsof -t -i:8089)
        echo "$PID"
        if [ "$PID" != "" ]; then
          kill -9 $PID
        fi
      - sleep 0.25
    silent: true
