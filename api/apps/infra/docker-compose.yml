version: "3.7"
services:
  infra:
    image: http://harbor.dev.madhouselabs.io/kloudlite/infra:v2
    container_name: infra-container
    volumes:
      - ~/kloudlite:~/kloudlite
    environment:
      GRPC_PORT: 50051
      SSH_KEYS_PATH: "~/kloudlite/keys"
      DATA_PATH: "~/kloudlite/data"
      CONFIG_DATA_PATH: "~/kloudlite/config"
      KAFKA_BOOTSTRAP_SERVERS: dev-kafka-headless.hotspot.svc.cluster.local:9092
      KAFKA_INFRA_TOPIC: dev-hotspot-infra
      KAFKA_INFRA_RESP_TOPIC: dev-hotspot-infra-resp
      KAFKA_GROUP_ID: infra-cli-local
      DO_API_KEY: ***REMOVED***
      DO_IMAGE_ID: 107908623
      NODE_DRAIN_TIME: 120
      MYSQL_CONNECTION_STRING: ***REMOVED***

    deploy:
      restart_policy:
        condition: on-failure
        delay: 5s
        max_attempts: 10 
        window: 120s
