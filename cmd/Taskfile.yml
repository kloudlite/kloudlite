version: 3

vars:
  BinDir: 
    sh: echo $PWD/"../bin"
  
  TMPL: "{{.BinDir}}/tmpl"
  SCHELM: "{{.BinDir}}/schelm"

tasks:
  setup:tmpl:
    internal: true
    silent: true
    vars:
      Version: v1.0.0
    env:
      CGO_ENABLED: 0
    cmds:
      - |+
        mkdir -p {{.BinDir}}
        go build -o {{.TMPL}} -ldflags="-s -w -X 'main.Version={{.Version}}'" ./tmpl

  setup:schelm:
    internal: true
    env:
      GO_BIN: "{{.BinDir}}"
    cmds:
      - |+
        if ! [ -f {{.SCHELM}} ] then
          go install github.com/databus23/schelm
        fi

  setup:
    tasks:
      cmds:
        - task: setup:tmpl
        - task: setup:schelm

