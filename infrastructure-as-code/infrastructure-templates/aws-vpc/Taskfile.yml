version: 3

tasks:
  sync-variables:
    vars:
      banner: |+
        /*
        DO NOT EDIT THIS FILE DIRECTLY. IT WILL BE OVERWRITTEN.
        If you need to change any variable, please edit the corresponding variables in the ${VARIABLE_FILE} file.
        If you want to create new variables, please create them in other files
        */
    env:
      BUNDLE_NAME: "aws-vpc"
      VARIABLE_FILE: "../../terraform/modules/aws/vpc/variables.tf"
    cmds:
      - |+
        name="./variables-$BUNDLE_NAME.tf"
        if [ -f "$name" ]; then
          chmod 600 "$name"
        fi
        
        cat > "$name" <<EOF
        {{.banner}}
        EOF
        
        cat "${VARIABLE_FILE}" >> $name
        chmod 400 "$name"
