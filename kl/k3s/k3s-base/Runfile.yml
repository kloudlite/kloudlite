tasks:
  build:

  pull:dns:
    cmd:
      - docker pull ghcr.io/kloudlite/operator/networking/cmd/dns:v1.0.8-nightly
      - docker image save ghcr.io/kloudlite/operator/networking/cmd/dns:v1.0.8-nightly -o ./images/dns.tar.gz

  pull:ip-manager:
    cmd:
      - docker pull ghcr.io/kloudlite/operator/networking/cmd/ip-manager:v1.0.8-nightly
      - docker image save ghcr.io/kloudlite/operator/networking/cmd/ip-manager:v1.0.8-nightly -o ./images/ip-manager.tar.gz

  pull:logs-proxy:
    cmd:
      - docker pull ghcr.io/kloudlite/operator/networking/cmd/logs-proxy:v1.0.8-nightly
      - docker image save ghcr.io/kloudlite/operator/networking/cmd/logs-proxy:v1.0.8-nightly -o ./images/logs-proxy.tar.gz

  pull:webhook:
    cmd:
      - docker pull ghcr.io/kloudlite/operator/networking/cmd/webhook:v1.0.8-nightly
      - docker image save ghcr.io/kloudlite/operator/networking/cmd/webhook:v1.0.8-nightly -o ./images/webhook.tar.gz

  pull:ip-binding-controller:
    cmd:
      - docker pull ghcr.io/kloudlite/operator/networking/cmd/ip-binding-controller:v1.0.8-nightly
      - docker image save ghcr.io/kloudlite/operator/networking/cmd/ip-binding-controller:v1.0.8-nightly -o ./images/ip-binding-controller.tar.gz

  pull:agent:
    cmd:
      - docker pull ghcr.io/kloudlite/api/tenant-agent:v1.0.8-nightly
      - docker image save ghcr.io/kloudlite/api/tenant-agent:v1.0.8-nightly -o ./images/kl-agent.tar.gz

  pull:agent-operator:
    cmd:
      - docker pull ghcr.io/kloudlite/operator/agent:v1.0.8-nightly
      - docker image save ghcr.io/kloudlite/operator/agent:v1.0.8-nightly -o ./images/kl-agent-operator.tar.gz

  download:images:
    cmd:
      - |+
        wget "https://github.com/k3s-io/k3s/releases/download/v1.31.1%2Bk3s1/k3s-airgap-images-amd64.tar" -O ./images/k3s-airgap-images-amd64.tars
        run pull:dns pull:ip-manager pull:logs-proxy pull:webhook pull:ip-binding-controller pull:agent -p

  container:build:
    cmd:
#      - run download:images
      - docker buildx build --platform linux/amd64,linux/arm64 -t ghcr.io/kloudlite/kl/k3s:latest . --push
