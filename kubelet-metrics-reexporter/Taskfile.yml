version: 3

tasks:
  dev:
    preconditions:
      - sh: '[ -z "{{.NodeName}}" ]'
        msg: 'var NodeName must be defined'
    cmds:
      - fwatcher --exec 'go run main.go --node-name {{.NodeName}} --dev --enrich-from-labels --filter-prefix "group.io/" --replace-prefix "group.io/=grp_"' --ext '.go'

  test:
    cmds:
      - fwatcher --ext '.go' --exec 'go test ./internal/parser/...'

  coverage:
    env:
      SHELL: fish
    cmds:
      - go-test-cover.sh ./internal/parser/...
