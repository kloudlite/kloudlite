{{- $ownerRefs := get . "owner-refs"}}
{{- $storageClass := get . "storage-class"}}
{{- $obj :=  get . "object" }}

{{- $generatedVars := mustFromJson ($obj.Status.GeneratedVars | toJson)}}

{{- with $obj }}
{{- /* gotype: operators.kloudlite.io/apis/mongodb-standalone.msvc/v1.Service */ -}}
apiVersion: msvc.kloudlite.io/v1
kind: HelmMongoDB
metadata:
  name: {{.Name}}
  namespace: {{.Namespace}}
  {{- if .Labels }}
  labels: {{ .Labels | toYAML | nindent 4 }}
  {{- end}}
  ownerReferences: {{ $ownerRefs | toYAML | nindent 4 }}
spec:
  global:
    storageClass: {{$storageClass}}
  fullnameOverride: {{.Name}}
  image:
    tag: 5.0.8-debian-10-r20

  {{- if .Labels }}
  commonLabels: {{.Labels | toYAML | nindent 4}}
  {{- end}}

  {{- if .Spec.NodeSelector}}
  nodeSelector: {{.Spec.NodeSelector | toYAML | nindent 4}}
  {{- end }}

  auth:
    enabled: true
    rootPassword: {{ index $generatedVars "root-password" }}
  persistence:
    enabled: true
    size: {{.Spec.Storage.Size}}
  volumePermissions:
    enabled: true
  metrics:
    enabled: false
  resources:
    requests:
      memory: {{ .Spec.Resources.Memory }}
    limits:
      cpu: {{ .Spec.Resources.Cpu}}
      memory: {{ .Spec.Resources.Memory}}
{{- end }}
