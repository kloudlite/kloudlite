tasks:
  workspace-ssh:
    dir: ./workspace-ssh
    env:
      image: ghcr.io/kloudlite/kloudlite/operator/workspace-ssh:debug
      cache_image: "ghcr.io/kloudlite/kloudlite/operator/workspace-ssh:build-cache"
    cmd:
      - |+
        docker buildx build -t "$image" \
          --cache-to type=registry,ref="$cache_image",mode=max,compression=zstd,compression-level=13,force-compression=true \
          --cache-from type=registry,ref="$cache_image" \
          --output=type=image,compression=zstd,force-compression=true,compression-level=13,push=true \
          .

  workspace-vscode-tunnel:
    dir: ./workspace-vscode-tunnel
    env:
      image: ghcr.io/kloudlite/kloudlite/operator/workspace-vscode-tunnel:debug
      cache_image: "ghcr.io/kloudlite/kloudlite/operator/workspace-vscode-tunnel:build-cache"
    cmd:
      - |+
        docker buildx build -t "$image" \
          --cache-to type=registry,ref="$cache_image",mode=max,compression=zstd,compression-level=13,force-compression=true \
          --cache-from type=registry,ref="$cache_image" \
          --output=type=image,compression=zstd,force-compression=true,compression-level=13,push=true \
          .


  workspace-code-server:
    dir: ./workspace-code-server
    env:
      image: ghcr.io/kloudlite/kloudlite/operator/workspace-code-server:debug
      cache_image: "ghcr.io/kloudlite/kloudlite/operator/workspace-code-server:build-cache"
    cmd:
      - |+
        docker buildx build -t "$image" \
          --cache-to type=registry,ref="$cache_image",mode=max,compression=zstd,compression-level=13,force-compression=true \
          --cache-from type=registry,ref="$cache_image" \
          --output=type=image,compression=zstd,force-compression=true,compression-level=13,push=true \
          .
