apiVersion: cluster-setup.kloudlite.io/v1
kind: PrimaryCluster
metadata:
  name: main
spec:
  clusterId: dev
  domain: "staged.kloudlite.io"
  cloudflareCreds:
    email: nxtcoder17@gmail.com
    secretKeyRef:
      name: cloudflare-zone-secret
      namespace: kube-system
      key: api-token
    dnsNames:
      - "*.staged.kloudlite.io"
  imagePullSecrets:
    - name: kloudlite-docker-registry
      namespace: kube-system
  loki:
    s3:
      awsAccessKeyId: ***REMOVED***
      awsSecretAccessKey: ***REMOVED***
      bucketName: first-one
      endpoint: s3.ap-northeast-1.wasabisys.com
    resources:
      cpu:
        min: 100m
        max: 200m
      memory: 200Mi

  prometheus:
    resources:
      cpu:
        min: 1200m
        max: 1800m
      memory: 2000Mi
      storage:
        size: 2Gi
        storageClass: local-path

  certManager:
    nodeSelector:
      kloudlite.io/master: "true"
    tolerations:
      - key: "kloudite.io/master"
        operator: "Equal"
        effect: "NoSchedule"
        value: "true"

    clusterIssuer:
      name: kl-cert-issuer
      acmeEmail: nxtcoder17@gmail.com
#      cloudflare:
#        secretKeyRef:
#          name:
#          namespace:
#          key:
#        dnsNames:
#          - '*.kloudlite.io'
      ingressClass: "ingress-nginx"

  ingress:
    className: ingress-nginx
    resources:
      cpu:
        min: 100m
        max: 200m
      memory: 200Mi

  oAuthCreds:
    name: oauth-secrets
    namespace: kube-system

  operators:
    manifests:
      - repo: kloudlite/operator
        tag: v1.0.4
        ghTokenSecret:
          name: kl-repo-gh-token
          namespace: kube-system
          key: "gh-token"
        artifacts:
#          - crds.yml
          - primary-operators.yml
      - repo: kloudlite/helm-operator
        tag: v1.0.0
        ghTokenSecret:
          name: kl-repo-gh-token
          namespace: kube-system
          key: "gh-token"
        artifacts:
          - crds.yml
          - operator.yml.tpl
      - repo: kloudlite/internal_operator_v2
        tag: v1.0.4
        ghTokenSecret:
          name: kl-repo-gh-token
          namespace: kube-system
          key: "gh-token"
        artifacts:
          - crds.yml
          - operator.yml.tpl
