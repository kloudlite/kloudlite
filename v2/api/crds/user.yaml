apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: users.platform.kloudlite.io
spec:
  group: platform.kloudlite.io
  versions:
  - name: v1alpha1
    served: true
    storage: true
    schema:
      openAPIV3Schema:
        type: object
        properties:
          spec:
            type: object
            required:
            - email
            - username
            properties:
              email:
                type: string
                pattern: '^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$'
                description: Email address of the user
              username:
                type: string
                minLength: 3
                maxLength: 30
                pattern: '^[a-z0-9][a-z0-9-]*[a-z0-9]$'
                description: Unique username for the user
              displayName:
                type: string
                maxLength: 100
                description: Display name of the user
              avatarUrl:
                type: string
                description: URL to user's avatar image
              role:
                type: string
                enum: ["admin", "developer", "viewer"]
                default: "developer"
                description: Role of the user in the platform
              active:
                type: boolean
                default: true
                description: Whether the user account is active
          status:
            type: object
            properties:
              phase:
                type: string
                enum: ["active", "inactive", "suspended", "pending"]
                description: Current status of the user
              lastLogin:
                type: string
                format: date-time
                description: Last login timestamp
              createdAt:
                type: string
                format: date-time
                description: User creation timestamp
              conditions:
                type: array
                items:
                  type: object
                  properties:
                    type:
                      type: string
                    status:
                      type: string
                    lastTransitionTime:
                      type: string
                      format: date-time
                    reason:
                      type: string
                    message:
                      type: string
    additionalPrinterColumns:
    - name: Username
      type: string
      jsonPath: .spec.username
    - name: Email
      type: string
      jsonPath: .spec.email
    - name: Role
      type: string
      jsonPath: .spec.role
    - name: Status
      type: string
      jsonPath: .status.phase
    - name: Age
      type: date
      jsonPath: .metadata.creationTimestamp
  scope: Cluster
  names:
    plural: users
    singular: user
    kind: User
    shortNames:
    - usr